<ion-header [translucent]="true" class="dash-header">
  <ion-toolbar>
    <ion-title class="brand">
      <span class="brand-mark">Gleisbau</span>
      <span class="brand-sub">Lernwelt</span>
    </ion-title>
    <ion-buttons slot="end" class="toolbar-actions">
      <ion-chip class="profile-chip" color="light" outline="true" (click)="goToProfile()">
        <ion-icon name="person-circle-outline"></ion-icon>
        <ion-label>Angemeldet als {{ displayName }}</ion-label>
      </ion-chip>
      <ion-button fill="clear" (click)="goToAdmin()">Admin Panel</ion-button>
      <ion-button fill="clear" routerLink="/home">Start</ion-button>
      <ion-button color="medium" (click)="handleLogout()">Logout</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="dash-content" [fullscreen]="true">
  <section class="welcome">
    <div class="welcome-copy">
      <p class="eyebrow">Uebersicht</p>
      <h1>Hallo {{ displayName }}, hier sind deine Lernfelder</h1>
      <p class="lede">
        Gleisbau-Module nach Lehrjahr mit zusaetzlichen Extras. Alte Standard-Lernfelder sind ausgeblendet.
      </p>
      <div class="search-wrap">
        <ion-searchbar
          [value]="searchTerm"
          (ionInput)="onSearchInput($event)"
          placeholder="Themen suchen, z. B. Schalung"
          [debounce]="0"
          [showClearButton]="'focus'"
        ></ion-searchbar>
        <p class="search-hint" *ngIf="hasActiveSearch">Treffer: {{ totalVisibleModules }}</p>
      </div>
      <div class="pill-row">
        <div class="pill">
          <span>Abgeschlossen</span>
          <strong>{{ summary.completed }}</strong>
        </div>
        <div class="pill">
          <span>In Arbeit</span>
          <strong>{{ summary.inProgress }}</strong>
        </div>
        <div class="pill">
          <span>Offen</span>
          <strong>{{ summary.planned }}</strong>
        </div>
      </div>
    </div>
  </section>

  <section class="grid-section" *ngFor="let group of yearGroups">
    <div class="section-head">
      <p class="eyebrow">Lehrjahr {{ group.year }}</p>
      <h2>Gleisbau Lernfelder</h2>
    </div>
    <ion-grid>
      <ion-row>
        <ion-col size="12" sizeMd="6" sizeLg="4" *ngFor="let module of group.modules">
          <ion-card class="tile-card highlight" [routerLink]="module.link">
            <ion-card-header>
              <div class="tile-top">
                <ion-chip color="tertiary" outline="true">
                  <ion-label>{{ module.tag }}</ion-label>
                </ion-chip>
                <ion-badge color="primary">{{ module.lf }}</ion-badge>
              </div>
              <ion-card-title>{{ module.title }}</ion-card-title>
              <ion-card-subtitle>{{ module.description }}</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <p class="tile-description">Direkter Zugang: {{ module.link }}</p>
              <div class="module-progress" *ngIf="moduleProgressByLink[module.link] as progress">
                <div class="progress-row">
                  <span>Fortschritt</span>
                  <span class="progress-value">{{ progress.completed }}/{{ progress.total }}</span>
                </div>
                <ion-progress-bar color="success" [value]="progress.ratio"></ion-progress-bar>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </section>

  <section class="grid-section" *ngIf="extraModules.length > 0">
    <div class="section-head">
      <p class="eyebrow">Extra</p>
      <h2>Zusatzmodule</h2>
    </div>
    <ion-grid>
      <ion-row>
        <ion-col size="12" sizeMd="6" sizeLg="4" *ngFor="let module of extraModules">
          <ion-card class="tile-card highlight" [routerLink]="module.link">
            <ion-card-header>
              <div class="tile-top">
                <ion-chip color="tertiary" outline="true">
                  <ion-label>{{ module.tag }}</ion-label>
                </ion-chip>
                <ion-badge color="primary">{{ module.lf }}</ion-badge>
              </div>
              <ion-card-title>{{ module.title }}</ion-card-title>
              <ion-card-subtitle>{{ module.description }}</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <p class="tile-description">Direkter Zugang: {{ module.link }}</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </section>

  <section class="no-results" *ngIf="hasActiveSearch && totalVisibleModules === 0">
    <ion-card class="tile-card">
      <ion-card-header>
        <ion-card-title>Keine Treffer</ion-card-title>
        <ion-card-subtitle>Fuer "{{ searchTerm }}" wurde kein Lernfeld gefunden.</ion-card-subtitle>
      </ion-card-header>
    </ion-card>
  </section>

</ion-content>
