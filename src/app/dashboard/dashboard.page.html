<ion-header [translucent]="true" class="dash-header">
  <ion-toolbar>
    <ion-title class="brand">
      <span class="brand-mark">Gleisbau</span>
      <span class="brand-sub">Lernwelt</span>
    </ion-title>
    <ion-buttons slot="end" class="toolbar-actions">
      <ion-chip color="light" outline="true">
        <ion-icon name="person-circle-outline"></ion-icon>
        <ion-label>Angemeldet als {{ user?.name || 'Admin' }}</ion-label>
      </ion-chip>
      <ion-button *ngIf="isAdmin()" fill="clear" (click)="goToAdmin()">Admin Panel</ion-button>
      <ion-button fill="clear" routerLink="/home">Start</ion-button>
      <ion-button color="medium" (click)="handleLogout()">Logout</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="dash-content" [fullscreen]="true">
  <section class="welcome">
    <div class="welcome-copy">
      <p class="eyebrow">Uebersicht</p>
      <h1>Hallo {{ user?.name || 'Admin' }}, hier sind deine Lernfelder</h1>
      <p class="lede">
        Bearbeite die Kacheln in deinem Tempo. Der Fortschrittsbalken zeigt dir sofort, was noch offen ist
        und welche Module du bereits abgeschlossen hast.
      </p>
      <div class="pill-row">
        <div class="pill">
          <span>Abgeschlossen</span>
          <strong>{{ summary.completed }}</strong>
        </div>
        <div class="pill">
          <span>In Arbeit</span>
          <strong>{{ summary.inProgress }}</strong>
        </div>
        <div class="pill">
          <span>Geplant</span>
          <strong>{{ summary.planned }}</strong>
        </div>
      </div>
    </div>
    <ion-card class="snapshot">
      <ion-card-header>
        <ion-card-subtitle>Schnellstart</ion-card-subtitle>
        <ion-card-title>Deine naechsten Schritte</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item>
            <ion-icon slot="start" name="shield-checkmark-outline" color="success"></ion-icon>
            <ion-label>Sicherheit & PSA abschliessen</ion-label>
            <ion-badge color="warning">78%</ion-badge>
          </ion-item>
          <ion-item>
            <ion-icon slot="start" name="git-branch-outline" color="primary"></ion-icon>
            <ion-label>Weichen & Kreuzungen weiterfuehren</ion-label>
            <ion-badge color="primary">35%</ion-badge>
          </ion-item>
          <ion-item>
            <ion-icon slot="start" name="build-outline" color="medium"></ion-icon>
            <ion-label>Schotter & Unterbau vorbereiten</ion-label>
            <ion-badge color="medium">0%</ion-badge>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </section>

  <section class="grid-section" *ngFor="let group of groupedTiles">
    <div class="section-head">
      <p class="eyebrow">Lehrjahr {{ group.year }}</p>
      <h2>Kacheln mit Fortschritt</h2>
    </div>
    <ion-grid>
      <ion-row>
        <ion-col size="12" sizeMd="6" sizeLg="4" *ngFor="let tile of group.fields">
          <ion-card class="tile-card" [class.completed]="tileStatus(tile.progress).label === 'Abgeschlossen'">
            <ion-card-header>
              <div class="tile-top">
                <ion-chip color="primary" outline="true">
                  <ion-label>{{ tile.tag }}</ion-label>
                </ion-chip>
                <ion-badge [color]="tileStatus(tile.progress).color">
                  <ion-icon *ngIf="tileStatus(tile.progress).label === 'Abgeschlossen'" name="checkmark-circle-outline"></ion-icon>
                  {{ tileStatus(tile.progress).label }}
                </ion-badge>
              </div>
              <ion-card-title>{{ tile.title }}</ion-card-title>
              <ion-card-subtitle>{{ tile.description }}</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <div class="progress-row">
                <ion-progress-bar [value]="tile.progress" [color]="tileStatus(tile.progress).color"></ion-progress-bar>
                <span class="progress-value">{{ (tile.progress * 100) | number:'1.0-0' }}%</span>
              </div>
              <p class="tile-description">Fehlversuche: {{ tile.mistakes }}</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </section>
</ion-content>
