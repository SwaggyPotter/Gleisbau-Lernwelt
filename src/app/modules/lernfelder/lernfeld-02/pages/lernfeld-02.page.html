<ion-header translucent="true">
  <ion-toolbar>
    <ion-title>Lernfeld 2: Bauwerke erschliessen &amp; gruenden</ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/dashboard" fill="clear">Zur Uebersicht</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="page-shell" *ngIf="!loading && !error; else stateBlock">
    <section class="hero">
      <div>
        <p class="eyebrow">Lernfeld 2</p>
        <h1>Bauwerke erschliessen und gruenden</h1>
        <p class="lede">
          Erd- und Gruendungsarbeiten planen: Baugrund beurteilen, Baugruben/Graeben sichern, Wasserhaltung waehlen,
          Fundamente lesen sowie Vermessung und Erschliessung sicher umsetzen.
        </p>
        <div class="badges">
          <ion-chip color="primary" outline="true">{{ quizTitle }}</ion-chip>
          <ion-chip color="success" outline="true">Arbeitsraum &amp; Sicherheit</ion-chip>
          <ion-chip color="tertiary" outline="true">Wasserhaltung &amp; Vermessung</ion-chip>
        </div>
      </div>
      <div class="progress">
        <div class="stat">
          <span>Abgeschlossene Bloecke</span>
          <strong>{{ progress.completedBlocks.length }}/{{ blocks.length }}</strong>
        </div>
        <div class="stat">
          <span>Beantwortete Quizfragen</span>
          <strong>{{ totalAnswered() }}</strong>
        </div>
      </div>
    </section>

    <ion-grid>
      <ion-row>
        <ion-col size="12" sizeLg="3">
          <div class="sticky-nav">
            <app-lf02-nav
              [blocks]="blocks"
              [completed]="progress.completedBlocks"
              [activeId]="selectedBlock?.id"
              (selectBlock)="selectBlock($event)"
            ></app-lf02-nav>
          </div>
        </ion-col>

        <ion-col size="12" sizeLg="9">
          <section *ngFor="let block of blocks" class="block" [attr.id]="block.id">
            <div class="block-head">
              <div>
                <p class="eyebrow">{{ block.id | uppercase }}</p>
                <h2>{{ block.title }}</h2>
                <p class="summary">{{ block.summary }}</p>
              </div>
              <ion-button
                color="success"
                (click)="toggleCompleted(block)"
                [fill]="progress.completedBlocks.includes(block.id) ? 'solid' : 'outline'"
              >
                Erledigt
              </ion-button>
            </div>

            <app-lf02-lesson-renderer [block]="block"></app-lf02-lesson-renderer>
          </section>
        </ion-col>
      </ion-row>
    </ion-grid>

    <section class="extras" *ngIf="quiz">
      <h3>Grosses Gesamtquiz Lernfeld 2</h3>
      <p>Alle Fragen aus Lernfeld 2 in einem Durchlauf. Nach jeder Antwort siehst du direkt, ob sie richtig oder falsch war.</p>
      <app-lf02-quiz-engine
        [questions]="quiz.questions"
        [shuffle]="false"
        [title]="overallQuizTitle"
        (answered)="quizAnswered($event)"
      ></app-lf02-quiz-engine>
    </section>
  </div>

  <ng-template #stateBlock>
    <ion-spinner *ngIf="loading"></ion-spinner>
    <p *ngIf="error">{{ error }}</p>
  </ng-template>
</ion-content>
