<ion-header translucent="true">
  <ion-toolbar>
    <ion-title>Lernfeld 3: Mauern eines einschaligen Baukoerpers</ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/dashboard" fill="clear">Zur Uebersicht</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="page-shell" *ngIf="!loading && !error; else stateBlock">
    <section class="hero">
      <div>
        <p class="eyebrow">Lernfeld 3</p>
        <h1>Mauern eines einschaligen Baukoerpers</h1>
        <p class="lede">
          Grundlagen fuer einschaliges Mauerwerk: Baustoffe und Verbandsregeln, Abstecken und erste Lage,
          sauberes Mauern, Oeffnungen mit Sturz, Abdichtung gegen Bodenfeuchte und sicheres Arbeiten.
        </p>
        <div class="badges">
          <ion-chip color="primary" outline="true">{{ quizTitle }}</ion-chip>
          <ion-chip color="success" outline="true">Verbandsregeln &amp; Ausfuehrung</ion-chip>
          <ion-chip color="tertiary" outline="true">Oeffnungen, Abdichtung &amp; Sicherheit</ion-chip>
        </div>
      </div>
      <div class="progress">
        <div class="stat">
          <span>Abgeschlossene Bloecke</span>
          <strong>{{ progress.completedBlocks.length }}/{{ blocks.length }}</strong>
        </div>
        <div class="stat">
          <span>Beantwortete Quizfragen</span>
          <strong>{{ totalAnswered() }}</strong>
        </div>
      </div>
    </section>

    <ion-grid>
      <ion-row>
        <ion-col size="12" sizeLg="3">
          <div class="sticky-nav">
            <app-lf03-nav
              [blocks]="blocks"
              [completed]="progress.completedBlocks"
              [activeId]="selectedBlock?.id"
              (selectBlock)="selectBlock($event)"
            ></app-lf03-nav>
          </div>
        </ion-col>

        <ion-col size="12" sizeLg="9">
          <section *ngFor="let block of blocks" class="block" [attr.id]="block.id">
            <div class="block-head">
              <div>
                <p class="eyebrow">{{ block.id | uppercase }}</p>
                <h2>{{ block.title }}</h2>
                <p class="summary">{{ block.summary }}</p>
              </div>
              <ion-button
                color="success"
                (click)="toggleCompleted(block)"
                [fill]="progress.completedBlocks.includes(block.id) ? 'solid' : 'outline'"
              >
                Erledigt
              </ion-button>
            </div>

            <app-lf03-lesson-renderer [block]="block"></app-lf03-lesson-renderer>

            <ion-accordion-group *ngIf="quiz">
              <ion-accordion [value]="block.id">
                <ion-item slot="header" color="light">
                  <ion-label>Quiz zu {{ block.title }}</ion-label>
                  <ion-chip color="primary" outline="true">
                    <ion-label>{{ block.quizRef?.length || '0' }} Fragen</ion-label>
                  </ion-chip>
                </ion-item>
                <div slot="content">
                  <app-lf03-quiz-engine
                    *ngIf="quiz"
                    [questions]="quiz.questions"
                    [questionIds]="block.quizRef"
                    [limit]="block.quizRef?.length || 3"
                    [title]="'Ueben: ' + block.title"
                    (answered)="quizAnswered($event)"
                  ></app-lf03-quiz-engine>
                </div>
              </ion-accordion>
            </ion-accordion-group>
          </section>
        </ion-col>
      </ion-row>
    </ion-grid>

    <section class="extras" *ngIf="quiz">
      <h3>Gesamtes Quiz (alle Fragen)</h3>
      <app-lf03-quiz-engine
        [questions]="quiz.questions"
        [shuffle]="true"
        [title]="overallQuizTitle"
        (answered)="quizAnswered($event)"
      ></app-lf03-quiz-engine>
    </section>
  </div>

  <ng-template #stateBlock>
    <ion-spinner *ngIf="loading"></ion-spinner>
    <p *ngIf="error">{{ error }}</p>
  </ng-template>
</ion-content>
