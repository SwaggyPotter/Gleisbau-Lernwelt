<ion-header translucent="true">
  <ion-toolbar>
    <ion-title>Lernfeld 12: Gleisanlagen instand halten</ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/dashboard" fill="clear">Zur Uebersicht</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="page-shell" *ngIf="!loading && !error; else stateBlock">
    <section class="hero">
      <div>
        <p class="eyebrow">Lernfeld 12</p>
        <h1>Gleisanlagen instand halten</h1>
        <p class="lede">
          Azubis beurteilen Zustaende von Gleisanlagen, erkennen typische Fehler und setzen
          Instandhaltungsmassnahmen wie Nachstopfen, Nachrichten und Sicherung im Bestand um.
        </p>
                        <div class="badges">
          <ion-chip color="primary" outline="true">{{ quizTitle }}</ion-chip>
          <ion-chip color="success" outline="true">Alltag im Gleisbau</ion-chip>
          <ion-chip color="tertiary" outline="true">Betriebssicherheit erhalten</ion-chip>
        </div>
        <div class="completion-meter">
          <div class="completion-meta">
            <span>Lernfortschritt</span>
            <strong>{{ progress.completedBlocks.length }}/{{ blocks.length }} Bloecke</strong>
          </div>
          <ion-progress-bar
            color="success"
            [value]="blocks.length ? progress.completedBlocks.length / blocks.length : 0"
          ></ion-progress-bar>
        </div>      
              </div>
      <div class="progress">
<div class="stat">
          <span>Abgeschlossene Bloecke</span>
          <strong>{{ progress.completedBlocks.length }}/{{ blocks.length }}</strong>
        </div>
        <div class="stat">
          <span>Beantwortete Quizfragen</span>
          <strong>{{ totalAnswered() }}</strong>
        </div>
            </div>
    </section>

    <ion-grid>
      <ion-row>
        <ion-col size="12" sizeLg="3">
          <div class="sticky-nav">
            <app-lf12-nav
              [blocks]="blocks"
              [completed]="progress.completedBlocks"
              [activeId]="selectedBlock?.id"
              (selectBlock)="selectBlock($event)"
            ></app-lf12-nav>
          </div>
        </ion-col>

        <ion-col size="12" sizeLg="9">
          <section *ngFor="let block of blocks" class="block" [attr.id]="block.id">
            <div class="block-head">
              <div>
                <p class="eyebrow">{{ block.id | uppercase }}</p>
                <h2>{{ block.title }}</h2>
                <p class="summary">{{ block.summary }}</p>
              </div>
              <ion-button
                class="complete-toggle"
                [color]="progress.completedBlocks.includes(block.id) ? 'success' : 'medium'"
                (click)="toggleCompleted(block)"
                [fill]="progress.completedBlocks.includes(block.id) ? 'solid' : 'outline'"
                [attr.aria-label]="progress.completedBlocks.includes(block.id) ? 'Als offen markieren' : 'Als erledigt markieren'"
              >
                <ion-icon slot="icon-only" name="checkmark"></ion-icon>
              </ion-button>
            </div>

            <app-lf12-lesson-renderer [block]="block"></app-lf12-lesson-renderer>
          </section>
        </ion-col>
      </ion-row>
    </ion-grid>

    <section class="extras" *ngIf="quiz">
      <h3>Grosses Gesamtquiz Lernfeld 12</h3>
      <p>Alle Fragen aus Lernfeld 12 in einem Durchlauf. Nach jeder Antwort siehst du direkt, ob sie richtig oder falsch war.</p>
      <app-lf12-quiz-engine
        [questions]="quiz.questions"
        [shuffle]="false"
        [title]="overallQuizTitle"
        (answered)="quizAnswered($event)"
      ></app-lf12-quiz-engine>
    </section>
  </div>

  <ng-template #stateBlock>
    <ion-spinner *ngIf="loading"></ion-spinner>
    <p *ngIf="error">{{ error }}</p>
  </ng-template>
</ion-content>










